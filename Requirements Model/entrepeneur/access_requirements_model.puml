@startuml entrepeneur_login_requirement
allow_mixing

skinparam shadow false

skinparam roundCorner 15

skinparam class {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}

skinparam usecase {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}





package "Activity Create Product" {
  circle " " as CP_Start <<start>>
  circle " " as CP_End <<end>>

  class "Mostrar Formulario de Producto" as CP_Form <<displayAction>> {
    {type=form}
    --
    + correo <<interactionPin>>
    + nombre <<interactionPin>>
    + descripcion <<interactionPin>>
    + precio <<interactionPin>>
    + cantidadExistencia <<interactionPin>>
    + foto <<interactionPin>>
  }

  class "Ingresar Datos de producto" as CP_Input <<userAction>> {
    + correo
    + nombre
    + descripcion
    + precio
    + foto
    + cantidad
  }

  class "Validar Datos" as CP_Validate <<systemAction>> {
    {validar}
  }

  class "Guardar en Inventario" as CP_Save <<systemAction>> {
    {confirmar}
    {guardar}
  }

  class "Mostrar Error" as CP_Error <<displayAction>> {
    {type=message}
    --
    + textoError <<displayPin>>
  }

  CP_Start --> CP_Form
  CP_Form --> CP_Input
  CP_Input --> CP_Validate : submit

  ' Bifurcación tras validar
  CP_Validate --> CP_Error : datos inválidos
  CP_Error --> CP_Form : reintentar

  CP_Validate --> CP_Save : datos válidos
  CP_Save --> CP_End : éxito
}

package "Activity Assign Existing Products" {
  circle " " as AE_Start <<start>>
  circle " " as AE_End <<end>>

  class "Obtener Catálogo y Colectivos" as AE_GetData <<systemAction>> {
    + listaMisProductos
    + listaColectivosDisponibles
  }

  class "Mostrar Formulario de Asignación" as AE_Form <<displayAction>> {
    {type=double-selector}
    --
    + listaMisProductos <<displayPin>>
    + listaColectivosDisponibles <<displayPin>>
  }

  class "Seleccionar Producto y Colectivo" as AE_Select <<userAction>> {
    + productId
    + colectivoId
  }

  class "Vincular en Sistema" as AE_Link <<systemAction>> {
    + productId
    + colectivoId
  }

  ' Nueva clase para el manejo de errores
  class "Mostrar Error de Vinculación" as AE_Error <<displayAction>> {
    {type=message}
    --
    + mensajeError <<displayPin>>
  }

  class "Notificar Éxito" as AE_Msg <<displayAction>> {
    {type=message}
    --
    + textoConfirmacion <<displayPin>>
  }

  AE_Start --> AE_GetData
  AE_GetData --> AE_Form
  AE_Form --> AE_Select
  AE_Select --> AE_Link : [asignar]
  
  AE_Link --> AE_Error : [error]
  AE_Error --> AE_Form : [reintentar]

  AE_Link --> AE_Msg : [éxito]
  AE_Msg --> AE_End
}


package "Activity Edit Product" {
  circle " " as EP_Start <<start>>
  circle " " as EP_End <<end>>

  class "Seleccionar producto" as EP_Select <<userAction>> {
    +productoId
  }


  class "Mostrar Formulario de Edición" as EP_Form <<displayAction>> {
    {type=form}
    --
    + nombre <<displayPin>>
    + descripcion <<displayPin>>
    + precio <<displayPin>>
    + cantidadExistencia <<displayPin>>
    + foto <<displayPin>>
    + etiqueta <<displayPin>>
  }

  class "Modificar Datos" as EP_Edit <<userAction>> {
    + nombre <<interactionPin>>
    + descripcion <<interactionPin>>
    + precio <<interactionPin>>
    + cantidadExistencia <<interactionPin>>
    + foto <<interactionPin>>
    + etiqueta <<interactionPin>>
  }

  class "Validar Cambios" as EP_Validate <<systemAction>> {
    {validar}
  }

  class "Actualizar en Inventario" as EP_Update <<systemAction>> {
    + nombre
    + descripcion
    + precio
    + cantidadExistencia
    + foto
    + etiqueta
  }

  class "Mostrar Error de Edición" as EP_Error <<displayAction>> {
    {type=message}
    --
    + mensajeError <<displayPin>>
  }

  class "Notificar Actualización" as EP_Msg <<displayAction>> {
    {type=toast}
    --
    + textoExito <<displayPin>>
  }

  ' Flujo de control
  EP_Start --> EP_Select
  EP_Select --> EP_Form
  EP_Form --> EP_Edit
  EP_Edit --> EP_Validate : submit

  EP_Validate --> EP_Error : [datos inválidos]
  EP_Error --> EP_Form : [reintentar]

  EP_Validate --> EP_Update : [datos válidos]
  EP_Update --> EP_Msg : [éxito]
  EP_Msg --> EP_End
}

package "Activity Delete Product" {

  circle " " as DP_Start <<start>>
  circle " " as DP_End <<end>>

  class "Seleccionar Producto" as DP_Select <<userAction>> {
    + productoId
  }

  class "Mostrar Modal de Confirmación" as DP_ConfirmRequest <<displayAction>> {
    {type=modal}
    --
    + nombreProducto <<displayPin>>
  }

  ' Representamos las dos acciones posibles del usuario
  class "Click en Confirmar" as DP_ConfirmBtn <<userAction>>{
    {confirmar}
  }
  class "Click en Cancelar" as DP_CancelBtn <<userAction>>{
    {cancelar}
  }

  class "Eliminar de Inventario" as DP_Delete <<systemAction>> {
    + productoId
  }

  class "Mostrar Error" as DP_Error <<displayAction>> {
    + mensajeError <<displayPin>>
  }

  class "Notificar Éxito" as DP_Success <<displayAction>> {
    + mensajeExito <<displayPin>>
  }

  DP_Start --> DP_Select
  DP_Select --> DP_ConfirmRequest

  ' El flujo se bifurca aquí por la acción del usuario
  DP_ConfirmRequest --> DP_ConfirmBtn
  DP_ConfirmRequest --> DP_CancelBtn

  ' Camino 1: Confirmación
  DP_ConfirmBtn --> DP_Delete
  DP_Delete --> DP_Error : [error]
  DP_Delete --> DP_Success : [éxito]

  ' Camino 2: Cancelación
  DP_CancelBtn --> DP_End

  DP_Error --> DP_End
  DP_Success --> DP_End
}

@enduml
