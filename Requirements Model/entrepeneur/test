@startuml entrepeneur_login_requirement
allow_mixing

skinparam shadow false
skinparam roundCorner 15

skinparam class {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}

skinparam usecase {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}

' =========================
' REQUIREMENT (USE CASES)
' =========================
package "Requirement Login" {
  actor "Emprendedor" as Entrepenuer

  usecase "Iniciar sesión" as Login <<processing>>
  usecase "Registrarse" as Register <<processing>>
  usecase "Recuperar contraseña" as Recover <<processing>>
}

Entrepenuer --> Login
Entrepenuer --> Register
Entrepenuer --> Recover
Recover ..> Login : <<extend>>\n[Olvidé mi contraseña]

' =========================
' ACTIVITY LOGIN
' =========================
package "Activity Login" {

  skinparam circleBackgroundColor black
  circle " " as AL_Start <<start>>
  circle " " as AL_End <<end>>

  class "Mostrar formulario de login" as AL_Form <<displayAction>> {
    {type=form}
    --
    + email <<interactionPin>>
    + password <<interactionPin>>
  }

  class "Ingresar credenciales" as AL_Input <<userAction>> {
    + email <<interactionPin>>
    + password <<interactionPin>>
  }

  class "Validar credenciales" as AL_Validate <<systemAction>> {
    {confirmed}
    --
    + validationResult <<displayPin>>
    + errorMessage <<displayPin>>
  }

  class "Crear sesión" as AL_Session <<systemAction>> {
    --
    + sessionId <<displayPin>>
    + token <<displayPin>>
  }

  AL_Start --> AL_Form
  AL_Form --> AL_Input : submit
  AL_Input --> AL_Validate : validate

  AL_Validate --> AL_Form : error
  AL_Validate --> AL_Session : success

  AL_Session --> AL_End
}

' =========================
' ACTIVITY REGISTER
' =========================
package "Activity Register" {

  skinparam circleBackgroundColor black
  circle " " as AR_Start <<start>>
  circle " " as AR_End <<end>>

  class "Mostrar formulario de registro" as AR_Form <<displayAction>> {
    {type=form}
    --
    + name <<interactionPin>>
    + email <<interactionPin>>
    + celular <<interactionPin>>
    + password <<interactionPin>>
    + confirmPassword <<interactionPin>>
    + ciudadSeleccionada <<interactionPin>>
    + colectivoSeleccionado <<interactionPin>>
    + cantidadEspacio <<interactionPin>>
    --
    + listaColectivos <<displayPin>>
  }

  class "Ingresar datos personales" as AR_Input <<userAction>> {
    + name <<interactionPin>>
    + email <<interactionPin>>
    + celular <<interactionPin>>
    + password <<interactionPin>>
    + confirmPassword <<interactionPin>>
  }

  class "Seleccionar departamento" as AR_SelectDept <<userAction>> {
    + ciudadSeleccionada <<interactionPin>>
  }

  class "Cargar colectivos por departamento" as AR_LoadColectivos <<systemAction>> {
    --
    + listaColectivos <<displayPin>>
  }

  class "Seleccionar colectivo" as AR_SelectColectivo <<userAction>> {
    + colectivoSeleccionado <<interactionPin>>
  }

  class "Indicar cantidad de espacio a alquilar" as AR_SpaceQty <<userAction>> {
    + cantidadEspacio <<interactionPin>>
  }

  class "Validar datos y solicitud" as AR_Validate <<systemAction>> {
    {confirmado}
    --
    + validationResult <<displayPin>>
    + errorMessage <<displayPin>>
  }

  class "Crear solicitud (pendiente)" as AR_CreateRequest <<systemAction>> {
    {estado=pendiente}
    --
    + requestId <<displayPin>>
    + estado <<displayPin>>
  }

  class "Notificar solicitud enviada" as AR_NotifyPending <<systemAction>> {
    --
    + pendingMessage <<displayPin>>
  }

  AR_Start --> AR_Form

  AR_Form --> AR_Input : submitDatos
  AR_Input --> AR_SelectDept : seleccionarDepartamento

  AR_SelectDept --> AR_LoadColectivos : solicitarColectivos
  AR_LoadColectivos --> AR_SelectColectivo : mostrarOpciones

  AR_SelectColectivo --> AR_SpaceQty : definirEspacio
  AR_SpaceQty --> AR_Validate : enviarSolicitud

  AR_Validate --> AR_Form : error
  AR_Validate --> AR_CreateRequest : success

  AR_CreateRequest --> AR_NotifyPending
  AR_NotifyPending --> AR_End : pendingReview
}

' =========================
' ACTIVITY RECOVER PASSWORD
' =========================
package "Activity Recover Password" {

  skinparam circleBackgroundColor black
  circle " " as AP_Start <<start>>
  circle " " as AP_End <<end>>

  class "Mostrar formulario de recuperación" as AP_Form <<displayAction>> {
    {type=form}
    --
    + email <<interactionPin>>
    + celular <<interactionPin>>
  }

  class "Ingresar email o celular" as AP_Input <<userAction>> {
    + email <<interactionPin>>
    + celular <<interactionPin>>
  }

  class "Validar identidad (email/celular)" as AP_Validate <<systemAction>> {
    {confirmado}
    --
    + validationResult <<displayPin>>
    + errorMessage <<displayPin>>
  }

  class "Enviar enlace/código de recuperación" as AP_Send <<systemAction>> {
    --
    + recoveryCodeOrLink <<displayPin>>
  }

  class "Notificar recuperación enviada" as AP_Notify <<systemAction>> {
    --
    + successMessage <<displayPin>>
  }

  AP_Start --> AP_Form
  AP_Form --> AP_Input : submit

  AP_Input --> AP_Validate : validate

  AP_Validate --> AP_Form : error
  AP_Validate --> AP_Send : success

  AP_Send --> AP_Notify
  AP_Notify --> AP_End : recoverySent
}

@enduml
