@startuml entrepeneur_login_requirement
allow_mixing

skinparam shadow false

skinparam roundCorner 15

skinparam class {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}

skinparam usecase {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}




package "Activity Login & Onboarding" {

  circle " " as AL_Start <<start>>
  circle " " as AL_End <<end>>
  skinparam circleBackgroundColor black

  class "Mostrar formulario de login" as AL_Form <<displayAction>> {
    {type=form}
    --
    + email <<interactionPin>>
    + password <<interactionPin>>
  }

  class "Ingresar credenciales" as AL_Input <<userAction>> {
    + email
    + password
  }

  class "Validar credenciales" as AL_Validate <<systemAction>> {
    {confirmar}
  }

  class "Mostrar mensaje de error" as AL_ShowError <<displayAction>> {
    {type=message}
    --
    + textoError <<displayPin>>
  }

  class "Inicializar Sesión" as AL_InitSession <<systemAction>> {
    {status: sesión activa}
  }

  class "Verificar datos de perfil" as AL_CheckProfile <<systemAction>>

  class "Formulario Información Completa" as AL_FullInfoForm <<displayAction>> {
    {type=form}
    --
    + nombreCompleto <<interactionPin>>
    + telefono <<interactionPin>>
    + direccion <<interactionPin>>
    + image <<interactionPin>>
    + descripcion <<interaction>>

  }

  class "Guardar información" as AL_SaveInfo <<systemAction>>{
    {guardar}
  }

  ' --- FLUJO PRINCIPAL ---

  AL_Start --> AL_Form
  AL_Form --> AL_Input : [usuario escribe]
  AL_Input --> AL_Validate : submit

  ' Manejo de error
  AL_Validate --> AL_ShowError : [credenciales incorrectas]
  AL_ShowError --> AL_Form : [reintentar]

  ' Éxito y Verificación
  AL_Validate --> AL_InitSession : [éxito]
  AL_InitSession --> AL_CheckProfile : [sesión creada]
  
  ' Decisión de flujo único
  AL_CheckProfile --> AL_End : [perfil ya completo]
  
  AL_CheckProfile --> AL_FullInfoForm : [perfil incompleto / primera vez]
  AL_FullInfoForm --> AL_SaveInfo : [enviar datos]
  AL_SaveInfo --> AL_End : [datos guardados]

}

package "Activity Register" {
  skinparam circleBackgroundColor black

  circle " " as AR_Start <<start>>
  circle " " as AR_End <<end>>

  class "Mostrar formulario de registro" as AR_Form <<displayAction>> {
    {type=form}
    --
    + name <<interactionPin>>
    + email <<interactionPin>>
    + celular <<interactionPin>>
    + password <<interactionPin>>
    + confirmPassword <<interactionPin>>
    + ciudad <<interactionPin>>
    ' Las listas que el sistema provee son displayPins
    + opcionesEspacio <<displayPin>>
    + colectivos <<displayPin>>
  }

  class "Ingresar datos y seleccionar opciones" as AR_Input <<userAction>> {
    --
    + name
    + email
    + celular
    + password
    + confirmPassword
    + ciudad
    + colectivoSeleccionado
    + cantidadEspacioSeleccionada
  }

  class "Validar datos y solicitud" as AR_Validate <<systemAction>> {
    {confirmado}
  }

  class "Mostrar mensaje de error" as AR_ShowError <<displayAction>> {
    {type=message}
    --
    + textoError <<displayPin>>
  }

  class "Crear solicitud (pendiente)" as AR_CreateRequest <<systemAction>> {
    {estado=pendiente}
  }

  class "Notificar solicitud enviada" as AR_NotifyPending <<systemAction>>

  ' Flujos del proceso
  AR_Start --> AR_Form
  
  AR_Form --> AR_Input : usuario completa y elige
  AR_Input --> AR_Validate : submitDatos

  ' Lógica de decisión
  AR_Validate --> AR_ShowError : error en datos
  AR_ShowError --> AR_Form : corregir
  
  AR_Validate --> AR_CreateRequest : datos válidos

  AR_CreateRequest --> AR_NotifyPending
  AR_NotifyPending --> AR_End
}


package "Activity Recover Password" {

  skinparam circleBackgroundColor black

  circle " " as AP_Start <<start>>
  circle " " as AP_End <<end>>

  class "Mostrar formulario de recuperación" as AP_Form <<displayAction>> {
    {type=form}
    --
    + email <<interactionPin>>
    + celular <<interactionPin>>
  }

  class "Ingresar email o celular" as AP_Input <<userAction>> {
    --
    + email
    + celular
  }

  class "Validar identidad (email/celular)" as AP_Validate <<systemAction>> {
    {confirmado}
  }

  class "Mostrar mensaje de error" as AP_ShowError <<displayAction>> {
    {type=message}
    --
    + textoError <<displayPin>>
  }

  class "Enviar enlace por Email" as AP_SendEmail <<systemAction>>
  class "Enviar código por SMS" as AP_SendSMS <<systemAction>>

  class "Notificar recuperación enviada" as AP_Notify <<systemAction>>

  ' Flujos con guardas de decisión directas (Estilo UWE)
  AP_Start --> AP_Form
  AP_Form --> AP_Input : usuario completa datos
  AP_Input --> AP_Validate : submit

  ' Error
  AP_Validate --> AP_ShowError : error: no existe usuario
  AP_ShowError --> AP_Form : reintentar

  ' Éxito y Bifurcación de canal
  AP_Validate --> AP_SendEmail : éxito: usó email
  AP_Validate --> AP_SendSMS : éxito: usó celular

  AP_SendEmail --> AP_Notify
  AP_SendSMS --> AP_Notify
  
  AP_Notify --> AP_End : recoverySent
}
@enduml
