@startuml
allow_mixing

skinparam shadow false
skinparam roundCorner 15
skinparam class {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}
skinparam usecase {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}

actor "Usuario Invitado" as AnonUser

' 1. Selección de ubicación
usecase "Selección de Ubicación" as SelectLocation <<processing>>

' a. Ir a login -> i. Registrarse
usecase "Ir a Login" as GoToLogin <<browsing>>
usecase "Registrarse" as Register <<processing>>

' b, d, e. Flujos que llevan a Lista de Productos
usecase "Ver Productos Más Vendidos" as ViewMostSold <<browsing>>
usecase "Buscar Producto" as SearchProduct <<browsing>>
usecase "Producto de Interés" as InterestProduct <<browsing>>
usecase "Ver Lista Tienda" as ViewStoreList <<browsing>>
usecase "Ver Productos Favoritos" as ViewFavoriteProducts <<browsing>>

' Sub-casos reutilizables
usecase "Ver Lista Producto" as ViewProductList <<browsing>>
usecase "Ver Detalle Producto" as ViewProductDetail <<browsing>>
usecase "Guardar Producto Favorito" as SaveInterestProduct <<processing>>


usecase "Ver Detalle Tienda" as ViewStoreDetail <<browsing>>
usecase "Ver Lista de Espacios Disponibles" as ViewSpaceList <<browsing>>
usecase "Ver Detalle de Espacios Disponibles" as ViewSpaceDetail <<browsing>>

' Relaciones

' 1. Ubicación
AnonUser --> SelectLocation

' a. Login
AnonUser --> GoToLogin
Register .> GoToLogin : <<extends>>
' Nota: Registrarse extiende la funcionalidad de Login (opción adicional)

' b. Producto más vendido -> Lista -> Detalle -> Guardar
AnonUser --> ViewMostSold
ViewMostSold ..> ViewProductList : <<include>>
ViewProductList ..> ViewProductDetail : <<include>>
SaveInterestProduct .> ViewProductDetail : <<extends>>

' e. Ver productos favoritos -> Lista -> Detalle -> Guardar
AnonUser --> ViewFavoriteProducts
ViewFavoriteProducts ..> ViewProductList : <<include>>

' c. Buscar producto -> Detalle -> Guardar
AnonUser --> SearchProduct
SearchProduct ..> ViewProductDetail : <<include>>
' Nota: Buscar puede llevar directo o vía lista, simplificado a detalle según jerarquía del usuario

' d. Producto de interés -> Lista -> Detalle -> Guardar
AnonUser --> InterestProduct
InterestProduct ..> ViewProductList : <<include>>
' (Conecta con flujo existente de Lista -> Detalle -> Guardar)

' e. Ver lista tienda -> Detalle tienda -> Espacios / Lista Productos
AnonUser --> ViewStoreList
ViewStoreList ..> ViewStoreDetail : <<include>>

' Detalle tienda tiene dos ramas:
ViewStoreDetail ..> ViewSpaceList : <<include>>
ViewStoreDetail ..> ViewProductList : <<include>>

' Rama Espacios
ViewSpaceList ..> ViewSpaceDetail : <<include>>

@enduml