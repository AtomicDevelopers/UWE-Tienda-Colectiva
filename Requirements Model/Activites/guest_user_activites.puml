@startuml guest_user_activities
allow_mixing

skinparam shadow false
skinparam roundCorner 15
skinparam class {
  BackgroundColor #FEFECE
  BorderColor #A80036
  ArrowColor #A80036
}
skinparam circleBackgroundColor black

' 1. Selección de Ubicación
package "Activity Selección de Ubicación" {
  circle " " as Loc_Start <<start>>
  circle " " as Loc_End <<end>>

  class "Detectar Ubicación" as Loc_Detect <<systemAction>> {
    --
    + ubicacionDetectada
  }

  class "Formulario Ubicación" as Loc_Form <<displayAction>> {
    {type=form}
    --
    <<interactionPin>>
    + direccionInput
    + mapaCoordenadas
  }

  class "Seleccionar Ubicación" as Loc_Select <<userAction>> {
    --
    + ubicacionSeleccionada
  }

  Loc_Start --> Loc_Detect
  Loc_Detect --> Loc_Form : display
  Loc_Form --> Loc_Select : confirm
  Loc_Select --> Loc_End
}

' 2. Login y Registro
package "Activity Login y Registro" {
  circle " " as Log_Start <<start>>
  circle " " as Log_End <<end>>

  class "Formulario Login" as Log_Form <<displayAction>> {
    {type=form}
    --
    <<interactionPin>>
    + email
    + password
    + botonRegistro
  }

  class "Ingresar Credenciales" as Log_Input <<userAction>> {
    --
    + email
    + password
  }

  class "Validar Credenciales" as Log_Validate <<systemAction>> {
    --
    + esValido
  }

  class "Formulario Registro" as Reg_Form <<displayAction>> {
    {type=form}
    --
    <<interactionPin>>
    + nombre
    + email
    + password
    + confirmarPassword
  }

  class "Registrar Usuario" as Reg_Action <<userAction>> {
    --
    + datosUsuario
  }

  Log_Start --> Log_Form
  Log_Form --> Log_Input : login
  Log_Form --> Reg_Form : register
  
  Log_Input --> Log_Validate
  Log_Validate --> Log_End : [valid]
  Log_Validate --> Log_Form : [invalid]

  Reg_Form --> Reg_Action : submit
  Reg_Action --> Log_End
}

' 3. Ver Productos (Más Vendidos, Búsqueda, Interés)
package "Activity Ver Productos" {
  circle " " as Prod_Start <<start>>
  circle " " as Prod_End <<end>>

  class "Lista de Productos" as Prod_List <<displayAction>> {
    {type=list}
    --
    <<displayPin>>
    + criterio (búsqueda/top/etc)
    + listaProductos
  }

  class "Seleccionar Producto" as Prod_Select <<userAction>> {
    --
    + selectedProductId
  }

  class "Detalle de Producto" as Prod_Detail <<displayAction>> {
    --
    <<displayPin>>
    + nombre
    + precio
    + descripcion
    + imagenes
    + botonGuardarInteres
  }

  class "Guardar Producto Interés" as Prod_Save <<userAction>> {
    --
    + productId
  }

  Prod_Start --> Prod_List
  Prod_List --> Prod_Select : click
  Prod_Select --> Prod_Detail : view
  
  Prod_Detail --> Prod_Save : interaction
  Prod_Save --> Prod_Detail : refresh
  
  Prod_Detail --> Prod_End : back/exit
}

' 4. Ver Tiendas (Tiendas -> Espacios/Productos)
package "Activity Ver Tiendas" {
  circle " " as Shop_Start <<start>>
  circle " " as Shop_End <<end>>

  class "Lista de Tiendas" as Shop_List <<displayAction>> {
    {type=list}
    --
    <<displayPin>>
    + listaTiendas
  }

  class "Seleccionar Tienda" as Shop_Select <<userAction>> {
    --
    + selectedShopId
  }

  class "Detalle Tienda" as Shop_Detail <<displayAction>> {
    --
    <<displayPin>>
    + infoTienda
    + opcionVerProductos
    + opcionVerEspacios
  }

  ' Rama Espacios
  class "Lista Espacios" as Space_List <<displayAction>> {
    {type=list}
    --
    + listaEspacios
  }

  class "Seleccionar Espacio" as Space_Select <<userAction>> {
    --
    + selectedSpaceId
  }

  class "Detalle Espacio" as Space_Detail <<displayAction>> {
    --
    + infoEspacio
    + disponibilidad
  }

  Shop_Start --> Shop_List
  Shop_List --> Shop_Select : click
  Shop_Select --> Shop_Detail : view

  ' Ramificación
  Shop_Detail --> Space_List : ver espacios
  
  ' Nota: La rama de productos conecta conceptualmente con "Navegación de Productos"
  ' pero aquí se modela la decisión de navegación.
  
  Space_List --> Space_Select : click
  Space_Select --> Space_Detail : view
  Space_Detail --> Shop_End
}

@enduml
